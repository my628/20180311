# 向URDF模型添加物理和碰撞属性

**说明：** 了解如何向链接添加碰撞和惯性属性，以及如何向关节添加关节动力学。

**教程级别：** 初学者



在本教程中，我们将了解如何向 URDF 模型添加一些基本物理属性以及如何指定其碰撞属性。


1. ### 碰撞

    到目前为止，我们只用一个子元素 visual 指定了我们的链接，它定义了（并不奇怪）机器人的样子。

    然而，为了让碰撞检测工作或在 Gazebo 之类的东西中模拟机器人，我们还需要定义一个碰撞元素。

    这是具有碰撞和物理特性的新 urdf。

    这是我们新的基本链接的代码。

    ```xml
    <link name="base_link">
        <visual>
          <geometry>
            <cylinder length="0.6" radius="0.2"/>
          </geometry>
          <material name="blue">
            <color rgba="0 0 .8 1"/>
          </material>
        </visual>
        <collision>
          <geometry>
            <cylinder length="0.6" radius="0.2"/>
          </geometry>
        </collision>
    </link>
    ```

    - 碰撞元素是链接对象的直接子元素，与视觉标签处于同一级别
    - 碰撞元素以与视觉元素相同的方式定义其形状，并带有几何标记。
        几何标记的格式在此处与视觉对象完全相同。
    - 你还可以以与碰撞标记的子元素相同的方式指定原点（与视觉一样）

    在许多情况下，你会希望碰撞几何体和原点与视觉几何体和原点完全相同。
    但是，有两种主要情况你不会。

    - 更快的处理 - 对两个网格进行碰撞检测比对两个简单几何进行更复杂的计算。
        因此，你能希望在碰撞元素中用更简单的几何图形替换网格。

    - 安全区 - 你可能希望限制靠近敏感设备的移动。
        例如，如果我们不想让任何物体与 R2D2 的头部发生碰撞，我们可以将碰撞几何体定义为一个圆柱体，包裹着他的头部，以防止任何物体靠近他的头部。
        
        

2. ### 物理性质

    为了让你的模型正确模拟，你需要定义机器人的几个物理属性，即像 Gazebo 这样的物理引擎需要的属性。

    1. #### 惯性

        每个被模拟的链接元素都需要一个惯性标签。
        
        这是一个简单的。
        
        ```xml
        <link name="base_link">
            <visual>
              <geometry>
                <cylinder length="0.6" radius="0.2"/>
              </geometry>
              <material name="blue">
                <color rgba="0 0 .8 1"/>
              </material>
            </visual>
            <collision>
              <geometry>
                <cylinder length="0.6" radius="0.2"/>
              </geometry>
            </collision>
            <inertial>
              <mass value="10"/>
              <inertia ixx="0.4" ixy="0.0" ixz="0.0" iyy="0.4" iyz="0.0" izz="0.2"/>
            </inertial>
          </link>
        ```
        
        - 此元素也是链接对象的子元素。
        - 质量以公斤定义。
        - 3x3 转动惯量矩阵由惯量元素指定。
            由于这是对称的，因此它只能由 6 个元素表示。
            
            
        - 这些信息可以通过 MeshLab 等建模程序提供给您。
            几何基元（圆柱、盒子、球体）的惯性可以使用维基百科的惯性张量列表计算（并在上面的例子中使用）。
        - 惯性张量取决于物体的质量和质量分布。
            一个好的初步近似是假设物体体积中的质量分布相等，并根据物体的形状计算惯性张量，如上所述。
        - 如果不确定要放什么，ixx/iyy/izz=1e-3 或更小的矩阵通常是中型链路的合理默认值（它对应于边长为 0.1 m、质量为 0.6 kg 的盒子）。
            虽然经常被选择，但单位矩阵是一个特别糟糕的默认值，因为它通常太高了（它对应于一个边长为 0.1 m、质量为 600 kg 的盒子！）。
        - 你还可以指定原点标记来指定重心和惯性参考系（相对于链接的参考系）。
        - 使用实时控制器时，零（或几乎为零）的惯性元素会导致机器人模型在没有警告的情况下崩溃，并且所有链接都将以其原点与世界原点重合出现。



    2. #### 接触系数

        你还可以定义链接在彼此接触时的行为方式。
        
        这是通过名为 contact_coefficients 的碰撞标签的子元素完成的。需要指定三个属性：

          - mu - 摩擦系数

          - kp - 刚度系数

          - kd - 阻尼系数

    3. #### 关节动力学

        关节的运动方式由关节的动力学标签定义。
        
        这里有两个属性：

          - 摩擦 - 物理静摩擦。对于棱柱接头，单位是牛顿。对于旋转接头，单位是牛顿米。
          - 阻尼 - 物理阻尼值。对于棱柱接头，单位是牛顿秒/米。对于旋转接头，牛顿米秒每弧度。

        如果未指定，这些系数默认为零。



3. ### 其他标签

    在纯 URDF 领域（即不包括 Gazebo 特定标签），还有两个标签可以帮助定义关节：校准和安全控制器。
    
    查看规范，因为它们不包含在本教程中。



4. ### 下一步

    使用 xacro 减少你必须执行的代码量和烦人的数学运算。
